<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notes App (FastAPI)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0e7ff, #fef9c3);
      margin: 0;
      padding: 0;
    }
    header {
      background: #2b6b9c;
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .container {
      max-width: 800px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      color: #133960;
    }
    input, textarea, select {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      font-size: 15px;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    button {
      background: #2c6c97;
      color: white;
      border: none;
      padding: 8px 14px;
      margin: 4px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #2b3b68;
    }
    .note {
      background: #f9fafb;
      border-left: 6px solid #acc2f3;
      padding: 15px;
      margin: 12px 0;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .note h4 {
      margin: 0;
      color: #1e293b;
    }
    .note small {
      color: #64748b;
      font-size: 13px;
    }
    .note-content {
      margin-top: 10px;
      display: none;
      color: #334155;
    }
    .delete-btn {
      background: #dc2626;
    }
    .delete-btn:hover {
      background: #b91c1c;
    }
    .category-btn {
      background: #46a3e5;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìù My Notes App</h1>
  </header>

  <div class="container">
    <h2>Create a Note</h2>
    <input id="title" placeholder="Enter note title" />
    <textarea id="content" placeholder="Write your note here..."></textarea>
    <select id="category">
      <option value="Study">Study</option>
      <option value="Personal">Personal</option>
      <option value="Office">Office</option>
      <option value="Schedule">Schedule</option>
      <option value="Diary">Diary</option>
    </select>
    <div><button onclick="createNote()">Add Note</button></div>
    <div>

    </div>
    <div>
      <button class="category-btn" onclick="setCategory('Personal')">1. Personal</button>
      <button class="category-btn" onclick="setCategory('Diary')">2. Diary</button>
      <button class="category-btn" onclick="setCategory('Schedule')">3. Schedule</button>
      <button class="category-btn" onclick="setCategory('Study')">4. Study</button>
      <button class="category-btn" onclick="setCategory('Office')">5. Office</button>
    </div>
    
    
    <h3 id="selected-category">Selected Category: None</h3>
    <div>
    <button onclick="showNote()">Show Note</button></div>
    <h2>Your Notes</h2>
    <div id="notes"></div>
  </div>
  <!-- Password Options Modal -->
<div id="pw-options-modal" class="modal-overlay">
  <div class="modal-content">
    <h3 id="pw-category-title">Password for Category</h3>
    <button onclick="startCreatePassword()">‚ûï Create Password</button>
    <button onclick="startExistingPassword()">üîê Use Existing Password</button>
    <button onclick="startForgotPassword()">‚ùì Forgot Password</button>
    <button onclick="closePwOptions()">Cancel</button>
    <p id="pw-options-error" style="color:red;"></p>
  </div>
</div>

<!-- Enter/Create Password Modal -->
<div id="pw-entry-modal" class="modal-overlay">
  <div class="modal-content">
    <h3 id="pw-entry-title">Password</h3>
    <input type="password" id="pw-input" placeholder="Password" />
    <div id="confirm-row" style="display:none;">
      <input type="password" id="pw-confirm" placeholder="Confirm Password" />
    </div>
    <button onclick="submitPassword()">Submit</button>
    <button onclick="closePwEntry()">Cancel</button>
    <p id="pw-entry-error" style="color:red;"></p>
  </div>
</div>

<!-- Styles for modals -->
<style>
.modal-overlay {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.4);
  z-index: 999;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: white;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  width: 280px;
}
</style>

  <script>
const API = "http://127.0.0.1:8000";
let selectedCategory = null;

// Store passwords for Personal and Diary (you can replace with localStorage if you want)
const categoryPasswords = { Personal: null, Diary: null };
// Track which categories have been authorized in this session
const authorizedCategories = { Personal: false, Diary: false };

// Set category when clicking category buttons or select dropdown
function setCategory(cat) {
  selectedCategory = cat;
  document.getElementById("selected-category").innerText = "Selected Category: " + cat;
  // Reset authorization only when switching categories
  if (cat === "Personal" || cat === "Diary") {
    authorizedCategories[cat] = false;
  }
}

// Password prompt handler used during Add Note
function handlePassword(category) {
  if (!categoryPasswords[category]) {
    let choice = prompt(`No password set for ${category}.\nType "new" to create one, or "cancel" to stop:`);

    if (!choice || choice.toLowerCase() === "cancel") return false;

    if (choice.toLowerCase() === "new") {
      let pw = prompt("Create a new password:");
      let confirm = prompt("Confirm the password:");
      if (pw !== confirm) {
        alert("Passwords do not match!");
        return false;
      }
      categoryPasswords[category] = pw;
      authorizedCategories[category] = true;
      alert("Password set successfully!");
      return true;
    } else {
      alert("Invalid input. Type 'new' or 'cancel'.");
      return false;
    }
  } else {
    // If already authorized, skip prompt
    if (authorizedCategories[category]) {
      return true;
    }
    let entered = prompt(`Enter password for ${category}:\nType "forgot" if you forgot it.`);
    if (entered === "forgot") {
      let contact = prompt("Enter your email or phone number to recover the password:");
      if (contact) {
        alert(`A recovery link would be sent to: ${contact} (simulated).`);
      } else {
        alert("No contact entered. Cannot recover.");
      }
      return false;
    }
    if (entered !== categoryPasswords[category]) {
      alert("Incorrect password!");
      return false;
    }
    authorizedCategories[category] = true;  // mark as authorized
  }
  return true;
}

async function createNote() {
  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();
  const category = document.getElementById("category").value;

  if (!title || !content) {
    alert("Please enter both title and content.");
    return;
  }

  let password = null;

  if (category === "Personal" || category === "Diary") {
    // Prompt for password only now, at Add Note button click
    if (!handlePassword(category)) {
      // Password prompt failed or canceled, stop
      return;
    }
    password = categoryPasswords[category];
  }

  const response = await fetch(API + "/notes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, content, category, password })
  });

  if (response.ok) {
    alert("‚úÖ Note added successfully!");
    // Clear input fields
    document.getElementById("title").value = "";
    document.getElementById("content").value = "";
    showNote(); // refresh notes list, notes start hidden for Personal/Diary
  } else {
    alert("‚ùå Failed to add note.");
  }
}

function showNote() {
  if (!selectedCategory) {
    alert("Please select a category first!");
    return;
  }

  if (selectedCategory === "Personal" || selectedCategory === "Diary") {
    // Require password to view notes in these categories
    if (!authorizedCategories[selectedCategory]) {
      if (!handlePassword(selectedCategory)) return;
    }
  }

  fetch(API + "/notes")
    .then(res => res.json())
    .then(data => {
      const notesDiv = document.getElementById("notes");
      notesDiv.innerHTML = "";

      const filtered = data.filter(note => note.category === selectedCategory);

      if (filtered.length === 0) {
        notesDiv.innerHTML = "<p>No notes found in this category.</p>";
        return;
      }

      filtered.forEach(note => {
        const div = document.createElement("div");
        div.className = "note";
        div.id = `note-${note.id}`;
        div.innerHTML = `
          <div class="note-header">
            <div>
              <h4>${note.title} <small>(${note.category})</small></h4>
              <small>${new Date(note.created_at).toLocaleString()}</small>
            </div>
            <div>
              <button onclick="toggleContent('${note.id}', \`${note.content}\`, '${note.category}')">Show</button>
              <button class="delete-btn" onclick="deleteNote('${note.id}')">Delete</button>
            </div>
          </div>
          <div id="content-${note.id}" class="note-content" style="display:none;"></div>
        `;
        notesDiv.appendChild(div);
      });
    });
}

function toggleContent(id, content, category) {
  const div = document.getElementById(`content-${id}`);

  if (div.style.display === "block") {
    // Content visible, hide it
    hideContent(id);
    return;
  }

  if (category === "Personal" || category === "Diary") {
    if (!authorizedCategories[category]) {
      if (!handlePassword(category)) return;
    }
  }

  div.innerHTML = `
    <p>${content}</p>
    <button onclick="hideContent('${id}')">Hide</button>
  `;
  div.style.display = "block";
}

function hideContent(id) {
  const div = document.getElementById(`content-${id}`);
  div.innerHTML = "";
  div.style.display = "none";
}

async function deleteNote(id) {
  await fetch(API + "/notes/" + id, { method: "DELETE" });
  showNote();
}

fetchNotes();

async function fetchNotes() {
  await fetch(API + "/notes"); // preload or refresh
}
</script>


</body>
</html>


